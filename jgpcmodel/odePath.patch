*** ../latest/jgpcmodel/OdePath.cpp	2011-07-01 17:28:21.000000000 -0400
--- OdePath.cpp	2011-07-03 09:30:14.319982857 -0400
***************
*** 59,64 ****
--- 59,65 ----
    P2D wpsave;
    bool dodging = false;
    int delay = 0;
+   float spd = 0.0; 
  
    gettimeofday(&lastSample, NULL);
    numWaypoints = loadWayPointFile("waypoints.dat",wpp);
***************
*** 97,102 ****
--- 98,109 ----
  	ocontact.px = p[0];
  	ocontact.py = p[1];
  	float ohead = path->getHeadingToPoint(currentpos, ocontact);
+ 	/*
+ 	if (path->distanceBetween(currentpos,ocontact) < 3.5) {
+ 	  spd = path->_ode->getSpeed();
+ 	  path->_ode->adjustSpeed(-0.001*spd);
+ 	}
+ 	*/
  	float courseChange;
  	// guard against 350 vs 10 in headings
  	if (fabsf(att[2] - ohead) > 45.0) {
***************
*** 115,126 ****
  	//printf("OdePath: dodging obs at %f %f from %f to heading %f\n",p[0],p[1],
  	//   att[2],att[2] + courseChange);
  	delay = 0;
!       } else if (delay++ > 22) { // no obstacles quit dodging after short delay
  	delay = 0;
  	// this brings us back toward the obstacle too quickly need to keep dodging for 
  	// a couple of extra counts
! 	if (dodging)
  	  destination = waypoints[wpcounter];
  	dodging = false;
  	}
      }
--- 122,139 ----
  	//printf("OdePath: dodging obs at %f %f from %f to heading %f\n",p[0],p[1],
  	//   att[2],att[2] + courseChange);
  	delay = 0;
!       } else if (delay++ > 28) { // no obstacles quit dodging after short delay
  	delay = 0;
+ 	/*
+ 	spd = path->_ode->getSpeed();
+ 	if (spd < 5.0) 
+ 	  path->_ode->adjustSpeed(1.1*spd);
+ 	*/
  	// this brings us back toward the obstacle too quickly need to keep dodging for 
  	// a couple of extra counts
! 	if (dodging) {
  	  destination = waypoints[wpcounter];
+ 	}
  	dodging = false;
  	}
      }
***************
*** 139,156 ****
        bool passedwp = false;
  
        float pcterror;
        if (dheading < 180 && heading > 180) {
  	pcterror = (dheading + 360 - heading) / 360;
        } else if (dheading > 180 && heading < 180) {
  	pcterror = (dheading -360 + heading) / 360;
        } else if (dheading < 180 && heading < 180) {
! 	pcterror = -(dheading - heading) / 360;
        }  else {
  	pcterror = (dheading - heading) / 360;
        }
        pcterror *= 1.75; // step up adjust vs steer
        //printf("dheading - heading %f - %f  = %f\n",dheading,heading,pcterror);
!       if (pcterror < -0.025 || pcterror > 0.025) { 
  	// steer by amount of error for 5 iterations then return to straight
  	adjsteer = pcterror;
  	if (adjsteer < -0.9)
--- 152,175 ----
        bool passedwp = false;
  
        float pcterror;
+       float dhd = (dheading - heading) > 180.0 ? dheading - 360.0 : dheading;
+       float hd = (heading - dheading) > 180.0 ? heading - 360.0 : heading;
+       pcterror = (dhd - hd) / 360;
+       /*
        if (dheading < 180 && heading > 180) {
  	pcterror = (dheading + 360 - heading) / 360;
        } else if (dheading > 180 && heading < 180) {
  	pcterror = (dheading -360 + heading) / 360;
        } else if (dheading < 180 && heading < 180) {
! 	// was divided by 360
! 	pcterror = (dheading - heading) / 360;
        }  else {
  	pcterror = (dheading - heading) / 360;
        }
+       */
        pcterror *= 1.75; // step up adjust vs steer
        //printf("dheading - heading %f - %f  = %f\n",dheading,heading,pcterror);
!       if (pcterror < -0.0139 || pcterror > 0.0139) { //  5degree error 
  	// steer by amount of error for 5 iterations then return to straight
  	adjsteer = pcterror;
  	if (adjsteer < -0.9)
***************
*** 164,170 ****
        //if (path->_ode->distanceRemaining(currentpos,destination) < 1.0 || 
        //  currentpos.px > destination.px && !dodging) {
  
!       if (path->_ode->distanceRemaining(currentpos,destination) < 1.0  && !dodging) {
  	if (wpcounter < numWaypoints-1) { 
  	  // move to next waypoint
  	  wpcounter++;
--- 183,189 ----
        //if (path->_ode->distanceRemaining(currentpos,destination) < 1.0 || 
        //  currentpos.px > destination.px && !dodging) {
  
!       if (path->_ode->distanceRemaining(currentpos,destination) < 1.9  && !dodging) {
  	if (wpcounter < numWaypoints-1) { 
  	  // move to next waypoint
  	  wpcounter++;
